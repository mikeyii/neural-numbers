(()=>{"use strict";var t,e,n,i,r=function(t,e,n){if(n||2===arguments.length)for(var i,r=0,o=e.length;r<o;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))},o=function(){function t(t){if(this.layersLayout=t,this.neurons=[],this.weights=[],this.biasesWeights=[],this.trainingEpoch=0,this.trainingIteration=0,this.trainingData=[],this.momentum=.7,this.learningRate=.3,this.NEEDED_ERROR_RATE=.01,this.RESET_WEIGHTS_AFTER=0,this.latestDeltaWeights=[],this.latestDeltaBiasesWeights=[],this._onEpochUpdate=function(){},t.length<3)throw new Error("There should be at least 1 hidden layer");this.init()}return t.prototype.initNeurons=function(){this.neurons=[];for(var t=[],e=0;e<this.layersLayout.length;e++)t[e]=new Float32Array(this.layersLayout[e]);this.neurons=r([],t,!0)},t.prototype.initWeights=function(){var t=this;this.weights=[];for(var e=[],n=1;n<this.neurons.length;n++){e[n-1]=[];for(var i=0;i<this.neurons[n].length;i++)e[n-1][i]=new Float32Array(this.neurons[n-1].length).map((function(){return t.random(-.5,.5)}))}this.weights=r([],e,!0);var o=this.weights.map((function(t){return t.map((function(t){return t.map((function(){return 0}))}))}));this.latestDeltaWeights=o},t.prototype.initBiases=function(){var t=this.neurons.slice(1).map((function(t){return t.map((function(){return Math.random()}))}));this.biasesWeights=t;var e=t.map((function(t){return t.map((function(){return 0}))}));this.latestDeltaBiasesWeights=e},t.prototype.random=function(t,e){return Math.random()*(e-t)+t},t.prototype.activationFunction=function(t){return 1/(1+Math.exp(-t))},t.prototype.derivative=function(t){return(1-t)*t},t.prototype.multiplyMatrix=function(t,e){return Float32Array.from(t).reduce((function(t,n,i){return t+n*e[i]}),0)},t.prototype.countMSEError=function(t,e){return 1===e.length?Math.pow(e[0]-t[0],2):e.reduce((function(n,i,r){return n+Math.pow(i-t[r],2)/e.length}),0)},t.prototype.trainIteration=function(t){for(var e=t.input,n=t.output,i=this.run(e),r=[],o=this.neurons.length-1;o>0;o--){r[o]=new Float32Array(this.neurons[o].length);for(var s=function(t){var e=a.neurons[o][t],s=void 0;if(o===a.neurons.length-1)s=(n[t]-i[t])*a.derivative(e);else{var h=a.multiplyMatrix(a.weights[o].map((function(e){return e[t]})),r[o+1]);s=a.derivative(e)*h}r[o][t]=s;for(var u=0;u<a.neurons[o-1].length;u++){var l=a.neurons[o-1][u]*s,c=a.learningRate*l+a.momentum*a.latestDeltaWeights[o-1][t][u];a.latestDeltaWeights[o-1][t][u]=c,a.weights[o-1][t][u]+=c}var f=a.neurons[o][t]*s,p=a.learningRate*f+a.momentum*a.latestDeltaBiasesWeights[o-1][t];a.latestDeltaBiasesWeights[o-1][t]=p,a.biasesWeights[o-1][t]+=p},a=this,h=0;h<this.neurons[o].length;h++)s(h)}return this.countMSEError(i,n)},t.prototype.init=function(){this.initNeurons(),this.initWeights(),this.initBiases()},t.prototype.setWeights=function(t){for(var e=t.weights,n=t.biases,i=0;i<this.weights.length;i++)for(var r=0;r<this.weights[i].length;r++)for(var o=0;o<this.weights[i][r].length;o++)this.weights[i][r][o]=e[i][r][o];for(i=0;i<this.biasesWeights.length;i++)for(r=0;r<this.biasesWeights[i].length;r++)this.biasesWeights[i][r]=n[i][r]},t.prototype.run=function(t){for(var e=0;e<this.neurons[0].length;e++)this.neurons[0][e]=t[e];for(e=1;e<this.neurons.length;e++)for(var n=0;n<this.neurons[e].length;n++){var i=this.multiplyMatrix(this.neurons[e-1],this.weights[e-1][n]),r=this.activationFunction(i+this.biasesWeights[e-1][n]);this.neurons[e][n]=r}return[].slice.call(this.neurons[this.neurons.length-1])},t.prototype.train=function(t,e){this.trainingData=t,this.epochsErrorRate=new Float32Array(e);for(var n=0;n<e;n++){this.RESET_WEIGHTS_AFTER&&n%this.RESET_WEIGHTS_AFTER==0&&this.epochsErrorRate[n-1]>this.NEEDED_ERROR_RATE&&(this.initWeights(),this.initBiases()),this.iterationsErrorRate=new Float32Array(t.length);for(var i=0;i<this.trainingData.length;i++){var r=this.trainIteration(t[i]);this.iterationsErrorRate[i]=r}var o=this.iterationsErrorRate.reduce((function(t,e){return t+e}))/t.length;this.epochsErrorRate[n]=o,this._onEpochUpdate(this.trainingEpoch),this.trainingEpoch+=1}},t.prototype.displayResult=function(t,e){var n=this.run(t).map((function(t){return+t.toFixed(3)}));console.log("".concat(n,", expected ").concat(e))},t.prototype.onEpochUpdate=function(t){this._onEpochUpdate=t},t}(),s=document.getElementById("clear"),a=document.getElementById("draw"),h=document.getElementById("result-table"),u=a.getContext("2d"),l=1,c={x:0,y:0},f=new o([784,16,16,10]);function p(){u.fillStyle="#000",u.fillRect(0,0,u.canvas.width,u.canvas.height),u.fillStyle="#fff",E(new Array(10).fill(0))}function g(t){if(t instanceof MouseEvent){if(0!==t.button)return;a.addEventListener("mousemove",y)}else a.addEventListener("touchmove",y);v(t)}function v(t){if(t.preventDefault(),t instanceof MouseEvent)c.x=t.offsetX/10-l/2,c.y=t.offsetY/10-l/2;else{var e=t.touches[0],n=a.offsetParent;c.x=(e.pageX-n.offsetLeft)/10-l/2,c.y=(e.pageY-n.offsetTop)/10-l/2}}function d(){a.removeEventListener("mousemove",y)}function y(t){u.beginPath(),u.lineWidth=2,u.lineCap="round",u.strokeStyle="#fff",u.moveTo(c.x,c.y),v(t),u.lineTo(c.x,c.y),u.stroke();var e,n=(e=u.getImageData(0,0,u.canvas.width,u.canvas.height),Array.from(e.data.filter((function(t,e){return e%4==0}))).map((function(t){return t/255})));E(f.run(n))}function E(t){var e=h.children[0].children;Array.from(e).forEach((function(e,n){e.children[1].innerText=(+t[n].toFixed(3)).toString()}))}t=void 0,e=void 0,i=function(){var t;return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(h){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,h])}}}(this,(function(e){switch(e.label){case 0:return[4,fetch("./3.json")];case 1:return[4,e.sent().json()];case 2:return t=e.sent(),f.setWeights(t),[2]}}))},new((n=void 0)||(n=Promise))((function(r,o){function s(t){try{h(i.next(t))}catch(t){o(t)}}function a(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}h((i=i.apply(t,e||[])).next())})),a.addEventListener("mousedown",g),a.addEventListener("mouseup",d),s.addEventListener("click",p),a.addEventListener("touchstart",g),a.addEventListener("touchend",d),u.canvas.width=28,u.canvas.height=28,p()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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bkN0QyxFQUFTd0IsaUJBQWlCLFFBQVNaLEdBRW5DVCxFQUFPcUIsaUJBQWlCLGFBQWNKLEdBQ3RDakIsRUFBT3FCLGlCQUFpQixXQUFZYyxHQUtsQ2pDLEVBQUlGLE9BQU9ZLE1BQVEsR0FDbkJWLEVBQUlGLE9BQU9hLE9BQVMsR0FDcEJKLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZXVyYWwtd2ViLy4vc3JjL05ldXJhbC50cyIsIndlYnBhY2s6Ly9uZXVyYWwtd2ViLy4vc3JjL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbInR5cGUgVHJhaW5pbmdEYXRhID0ge1xuICByZWFkb25seSBpbnB1dDogbnVtYmVyW107XG4gIHJlYWRvbmx5IG91dHB1dDogbnVtYmVyW107XG59O1xuXG5leHBvcnQgY2xhc3MgTmV1cmFsIHtcbiAgbmV1cm9uczogRmxvYXQzMkFycmF5W10gPSBbXTtcbiAgd2VpZ2h0czogRmxvYXQzMkFycmF5W11bXSA9IFtdO1xuICBiaWFzZXNXZWlnaHRzOiBGbG9hdDMyQXJyYXlbXSA9IFtdO1xuXG4gIHRyYWluaW5nRXBvY2ggPSAwO1xuICB0cmFpbmluZ0l0ZXJhdGlvbiA9IDA7XG4gIHRyYWluaW5nRGF0YTogVHJhaW5pbmdEYXRhW10gPSBbXTtcblxuICAvLyB0byBqdW1wIG92ZXIgbG9jYWwgbWluaW11bXNcbiAgbW9tZW50dW0gPSAwLjc7XG4gIC8vIGhvdyBmYXIgd2Ugd2lsbCBiZSBqdW1waW5nIChmcm9tIDAuMDAxIHRvIDAuMyBpcyBvcHRpbWFsLCBtb3JlIG5ldXJvbnMgPT4gbGVzcyBsZWFybmluZ1JhdGUpXG4gIGxlYXJuaW5nUmF0ZSA9IDAuMztcblxuICAvLyBpZiB3ZSBkb24ndCBtZWV0IG5lZWRlZCByYXRlIC0gd2UgY2FuIHJlc2V0IHdlaWdodHNcbiAgLy8gbmVlZGVkIGVycm9yIHJhdGVcbiAgTkVFREVEX0VSUk9SX1JBVEUgPSAwLjAxO1xuICAvLyBSZXNldCB3ZWlndHMgYWZ0ZXIgaXRlcmF0aW9uLCBpZiAwIC0gdGhlbiB3ZSBpZ25vcmUgaXRcbiAgUkVTRVRfV0VJR0hUU19BRlRFUiA9IDA7XG5cbiAgLy8gd2UgdXNlIGl0IGZvciBtZW1lbnR1bVxuICBwcml2YXRlIGxhdGVzdERlbHRhV2VpZ2h0czogRmxvYXQzMkFycmF5W11bXSA9IFtdO1xuICBwcml2YXRlIGxhdGVzdERlbHRhQmlhc2VzV2VpZ2h0czogRmxvYXQzMkFycmF5W10gPSBbXTtcblxuICBwdWJsaWMgaXRlcmF0aW9uc0Vycm9yUmF0ZTogRmxvYXQzMkFycmF5O1xuICBwdWJsaWMgZXBvY2hzRXJyb3JSYXRlOiBGbG9hdDMyQXJyYXk7XG5cbiAgcHJpdmF0ZSBfb25FcG9jaFVwZGF0ZTogQ2FsbGFibGVGdW5jdGlvbiA9ICgpID0+IHt9O1xuXG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IGxheWVyc0xheW91dDogbnVtYmVyW10pIHtcbiAgICBpZiAobGF5ZXJzTGF5b3V0Lmxlbmd0aCA8IDMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhlcmUgc2hvdWxkIGJlIGF0IGxlYXN0IDEgaGlkZGVuIGxheWVyJyk7XG4gICAgfVxuICAgIHRoaXMuaW5pdCgpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGluaXROZXVyb25zKCkge1xuICAgIHRoaXMubmV1cm9ucyA9IFtdO1xuXG4gICAgY29uc3QgbmV1cm9uczogRmxvYXQzMkFycmF5W10gPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5sYXllcnNMYXlvdXQubGVuZ3RoOyBpKyspIHtcbiAgICAgIG5ldXJvbnNbaV0gPSBuZXcgRmxvYXQzMkFycmF5KHRoaXMubGF5ZXJzTGF5b3V0W2ldKTtcbiAgICB9XG5cbiAgICB0aGlzLm5ldXJvbnMgPSBbLi4ubmV1cm9uc107XG4gIH1cblxuICAvLyBhbHdheXMgYWZ0ZXIgaW5pdGlhbGl6aW5nIG5ldXJvbnNcbiAgcHJvdGVjdGVkIGluaXRXZWlnaHRzKCkge1xuICAgIHRoaXMud2VpZ2h0cyA9IFtdO1xuICAgIGNvbnN0IHdlaWdodHM6IEZsb2F0MzJBcnJheVtdW10gPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMubmV1cm9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgd2VpZ2h0c1tpIC0gMV0gPSBbXTtcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5uZXVyb25zW2ldLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIHdlaWdodHNbaSAtIDFdW2pdID0gbmV3IEZsb2F0MzJBcnJheSh0aGlzLm5ldXJvbnNbaSAtIDFdLmxlbmd0aCkubWFwKFxuICAgICAgICAgICgpID0+IHRoaXMucmFuZG9tKC0wLjUsIDAuNSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLndlaWdodHMgPSBbLi4ud2VpZ2h0c107XG5cbiAgICAvLyBzYXZlIGxhdGVzdCBkZWx0YSB3ZWlnaHRzIGZvciBtb21lbnR1bVxuICAgIGNvbnN0IGxhdGVzdERlbHRhV2VpZ2h0cyA9IHRoaXMud2VpZ2h0cy5tYXAoKGxheWVyKSA9PlxuICAgICAgbGF5ZXIubWFwKChuZXVyb24pID0+IG5ldXJvbi5tYXAoKCkgPT4gMCkpXG4gICAgKTtcbiAgICB0aGlzLmxhdGVzdERlbHRhV2VpZ2h0cyA9IGxhdGVzdERlbHRhV2VpZ2h0cztcbiAgfVxuXG4gIC8vIGFsd2F5cyBhZnRlciBpbml0aWFsaXppbmcgbmV1cm9uc1xuICBwcm90ZWN0ZWQgaW5pdEJpYXNlcygpIHtcbiAgICAvLyBjb3B5IG9mIG5ldXJvbnMgc3RhcnRpbmcgZnJvbSBsYXllciAxIGFuZCBzZXQgZXZlcnkgdG8gcmFuZG9tIHZhbHVlXG4gICAgY29uc3QgYmlhc2VzV2VpZ2h0cyA9IHRoaXMubmV1cm9uc1xuICAgICAgLnNsaWNlKDEpXG4gICAgICAubWFwKChsYXllcikgPT4gbGF5ZXIubWFwKCgpID0+IE1hdGgucmFuZG9tKCkpKTtcbiAgICB0aGlzLmJpYXNlc1dlaWdodHMgPSBiaWFzZXNXZWlnaHRzO1xuXG4gICAgY29uc3QgbGF0ZXN0RGVsdGFCaWFzZXNXZWlnaHRzID0gYmlhc2VzV2VpZ2h0cy5tYXAoKGxheWVyKSA9PlxuICAgICAgbGF5ZXIubWFwKCgpID0+IDApXG4gICAgKTtcbiAgICB0aGlzLmxhdGVzdERlbHRhQmlhc2VzV2VpZ2h0cyA9IGxhdGVzdERlbHRhQmlhc2VzV2VpZ2h0cztcbiAgfVxuXG4gIHByaXZhdGUgcmFuZG9tKG1pbjogbnVtYmVyLCBtYXg6IG51bWJlcikge1xuICAgIHJldHVybiBNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbikgKyBtaW47XG4gIH1cblxuICAvLyBzaWdtb2lkXG4gIHByb3RlY3RlZCBhY3RpdmF0aW9uRnVuY3Rpb24oeDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gMSAvICgxICsgTWF0aC5leHAoLXgpKTtcbiAgfVxuXG4gIC8vIGRlcml2YXRpdmUgb2Ygc2lnbW9pZFxuICBwcm90ZWN0ZWQgZGVyaXZhdGl2ZShvdXRwdXQ6IG51bWJlcik6IG51bWJlciB7XG4gICAgcmV0dXJuICgxIC0gb3V0cHV0KSAqIG91dHB1dDtcbiAgfVxuXG4gIC8vIGltcHJvdmUgaXQncyBwZXJmb3JtYW5jZSB3aXRoIGdwdVxuICBwcml2YXRlIG11bHRpcGx5TWF0cml4KFxuICAgIGE6IEZsb2F0MzJBcnJheSB8IG51bWJlcltdLFxuICAgIGI6IEZsb2F0MzJBcnJheSB8IG51bWJlcltdXG4gICkge1xuICAgIHJldHVybiBGbG9hdDMyQXJyYXkuZnJvbShhKS5yZWR1Y2UoKHN1bSwgY3VyLCBpKSA9PiBzdW0gKyBjdXIgKiBiW2ldLCAwKTtcbiAgfVxuXG4gIHByaXZhdGUgY291bnRNU0VFcnJvcihyZXN1bHQ6IG51bWJlcltdLCBvdXRwdXQ6IG51bWJlcltdKSB7XG4gICAgaWYgKG91dHB1dC5sZW5ndGggPT09IDEpIHJldHVybiAob3V0cHV0WzBdIC0gcmVzdWx0WzBdKSAqKiAyO1xuICAgIHJldHVybiBvdXRwdXQucmVkdWNlKFxuICAgICAgKHN1bSwgb3V0LCBpKSA9PiBzdW0gKyAob3V0IC0gcmVzdWx0W2ldKSAqKiAyIC8gb3V0cHV0Lmxlbmd0aCxcbiAgICAgIDBcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSB0cmFpbkl0ZXJhdGlvbih7IGlucHV0LCBvdXRwdXQgfTogVHJhaW5pbmdEYXRhKTogbnVtYmVyIHtcbiAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJ1bihpbnB1dCk7XG4gICAgY29uc3QgZGVsdGFOZXVyb25zOiBGbG9hdDMyQXJyYXlbXSA9IFtdO1xuICAgIC8vIHVwZGF0ZSB3ZWlnaHRzIHdpdGggYmFjayBwcm9wYWdhdGlvblxuICAgIC8vIGh0dHBzOi8vaGFici5jb20vcnUvYXJ0aWNsZXMvMzEzMjE2L1xuICAgIGZvciAobGV0IGkgPSB0aGlzLm5ldXJvbnMubGVuZ3RoIC0gMTsgaSA+IDA7IGktLSkge1xuICAgICAgLy8gbGF5ZXJcbiAgICAgIGRlbHRhTmV1cm9uc1tpXSA9IG5ldyBGbG9hdDMyQXJyYXkodGhpcy5uZXVyb25zW2ldLmxlbmd0aCk7XG5cbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5uZXVyb25zW2ldLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIC8vIG91dHB1dCBuZXVyb25cbiAgICAgICAgY29uc3Qgb3V0cHV0TmV1cm9uID0gdGhpcy5uZXVyb25zW2ldW2pdO1xuICAgICAgICBsZXQgZGVsdGFOZXVyb246IG51bWJlcjtcbiAgICAgICAgaWYgKGkgPT09IHRoaXMubmV1cm9ucy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgLy8gb3V0cHV0IG5ldXJvbiBkZWx0YSBpczogRXJyb3IgKiBGJyhvdXQpXG4gICAgICAgICAgY29uc3QgZXJyb3IgPSBvdXRwdXRbal0gLSByZXN1bHRbal07XG4gICAgICAgICAgZGVsdGFOZXVyb24gPSBlcnJvciAqIHRoaXMuZGVyaXZhdGl2ZShvdXRwdXROZXVyb24pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGhpZGRlbiBuZXVyb24gZGVsdGEgaXM6IEYnKG91dCkgKiDOoyh3aSAqIGRpKVxuICAgICAgICAgIC8vIGRlcml2YXRpdmUgKiBzdW0gb2YgYWxsIG91dHB1dCB3ZWlnaHRzICogZGVsdGEgb2YgY29ubmVjdGVkIG5ldXJvblxuICAgICAgICAgIC8vIG1hdHJpeCBvcGVyYXRpb25cblxuICAgICAgICAgIGNvbnN0IHdlaWdodHNTdW06IG51bWJlciA9IHRoaXMubXVsdGlwbHlNYXRyaXgoXG4gICAgICAgICAgICB0aGlzLndlaWdodHNbaV0ubWFwKCh2KSA9PiB2W2pdKSxcbiAgICAgICAgICAgIGRlbHRhTmV1cm9uc1tpICsgMV1cbiAgICAgICAgICApO1xuICAgICAgICAgIGRlbHRhTmV1cm9uID0gdGhpcy5kZXJpdmF0aXZlKG91dHB1dE5ldXJvbikgKiB3ZWlnaHRzU3VtO1xuICAgICAgICB9XG4gICAgICAgIGRlbHRhTmV1cm9uc1tpXVtqXSA9IGRlbHRhTmV1cm9uO1xuICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IHRoaXMubmV1cm9uc1tpIC0gMV0ubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICAvLyBpbnB1dCBuZXVyb25cbiAgICAgICAgICAvLyB1cGRhdGUgYWxsIHdlaWdodHMgdGhhdCBnbyBmcm9tIHRoZSBvdXRwdXQgbmV1cm9uXG4gICAgICAgICAgLy8gbWF0cml4IG9wZXJhdGlvblxuICAgICAgICAgIGNvbnN0IGdyYWQgPSB0aGlzLm5ldXJvbnNbaSAtIDFdW2tdICogZGVsdGFOZXVyb247XG4gICAgICAgICAgY29uc3QgZHcgPVxuICAgICAgICAgICAgdGhpcy5sZWFybmluZ1JhdGUgKiBncmFkICtcbiAgICAgICAgICAgIHRoaXMubW9tZW50dW0gKiB0aGlzLmxhdGVzdERlbHRhV2VpZ2h0c1tpIC0gMV1bal1ba107XG4gICAgICAgICAgdGhpcy5sYXRlc3REZWx0YVdlaWdodHNbaSAtIDFdW2pdW2tdID0gZHc7XG4gICAgICAgICAgdGhpcy53ZWlnaHRzW2kgLSAxXVtqXVtrXSArPSBkdztcbiAgICAgICAgfVxuICAgICAgICAvLyB1cGRhdGUgYmlhc2VzXG4gICAgICAgIC8vIG1hdHJpeCBvcGVyYXRpb25cbiAgICAgICAgY29uc3QgZ3JhZCA9IHRoaXMubmV1cm9uc1tpXVtqXSAqIGRlbHRhTmV1cm9uO1xuICAgICAgICBjb25zdCBkdyA9XG4gICAgICAgICAgdGhpcy5sZWFybmluZ1JhdGUgKiBncmFkICtcbiAgICAgICAgICB0aGlzLm1vbWVudHVtICogdGhpcy5sYXRlc3REZWx0YUJpYXNlc1dlaWdodHNbaSAtIDFdW2pdO1xuICAgICAgICB0aGlzLmxhdGVzdERlbHRhQmlhc2VzV2VpZ2h0c1tpIC0gMV1bal0gPSBkdztcbiAgICAgICAgdGhpcy5iaWFzZXNXZWlnaHRzW2kgLSAxXVtqXSArPSBkdztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY291bnRNU0VFcnJvcihyZXN1bHQsIG91dHB1dCk7XG4gIH1cblxuICBpbml0KCkge1xuICAgIHRoaXMuaW5pdE5ldXJvbnMoKTtcbiAgICB0aGlzLmluaXRXZWlnaHRzKCk7XG4gICAgdGhpcy5pbml0Qmlhc2VzKCk7XG4gIH1cblxuICBzZXRXZWlnaHRzKHtcbiAgICB3ZWlnaHRzLFxuICAgIGJpYXNlcyxcbiAgfToge1xuICAgIHdlaWdodHM6IG51bWJlcltdW11bXTtcbiAgICBiaWFzZXM6IG51bWJlcltdW107XG4gIH0pIHtcbiAgICAvLyB0byBwcmV2ZW50IGFueSBwcm9ibGVtcyB3aXRoIGNvcHlpbmcgYW5kIEZsb2F0NjRcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMud2VpZ2h0cy5sZW5ndGg7IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLndlaWdodHNbaV0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCB0aGlzLndlaWdodHNbaV1bal0ubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICB0aGlzLndlaWdodHNbaV1bal1ba10gPSB3ZWlnaHRzW2ldW2pdW2tdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIC8vIHRvIHByZXZlbnQgYW55IHByb2JsZW1zIHdpdGggY29weWluZyBhbmQgRmxvYXQ2NFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5iaWFzZXNXZWlnaHRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuYmlhc2VzV2VpZ2h0c1tpXS5sZW5ndGg7IGorKykge1xuICAgICAgICB0aGlzLmJpYXNlc1dlaWdodHNbaV1bal0gPSBiaWFzZXNbaV1bal07XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcnVuKGlucHV0RGF0YTogbnVtYmVyW10pOiBudW1iZXJbXSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm5ldXJvbnNbMF0ubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMubmV1cm9uc1swXVtpXSA9IGlucHV0RGF0YVtpXTtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMubmV1cm9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLm5ldXJvbnNbaV0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgY29uc3QgbmV1cm9uSW5wdXQgPSB0aGlzLm11bHRpcGx5TWF0cml4KFxuICAgICAgICAgIHRoaXMubmV1cm9uc1tpIC0gMV0sXG4gICAgICAgICAgdGhpcy53ZWlnaHRzW2kgLSAxXVtqXVxuICAgICAgICApO1xuICAgICAgICAvLyBhZGQgYmlhcyB0byB0aGUgb3ZlcmFsbCBzdW1cbiAgICAgICAgY29uc3QgbmV1cm9uVmFsdWUgPSB0aGlzLmFjdGl2YXRpb25GdW5jdGlvbihcbiAgICAgICAgICBuZXVyb25JbnB1dCArIHRoaXMuYmlhc2VzV2VpZ2h0c1tpIC0gMV1bal1cbiAgICAgICAgKTtcblxuICAgICAgICB0aGlzLm5ldXJvbnNbaV1bal0gPSBuZXVyb25WYWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIFtdLnNsaWNlLmNhbGwodGhpcy5uZXVyb25zW3RoaXMubmV1cm9ucy5sZW5ndGggLSAxXSk7XG4gIH1cblxuICB0cmFpbih0cmFpbmluZ0RhdGE6IFRyYWluaW5nRGF0YVtdLCBlcG9jaEFtb3VudDogbnVtYmVyKSB7XG4gICAgdGhpcy50cmFpbmluZ0RhdGEgPSB0cmFpbmluZ0RhdGE7XG4gICAgdGhpcy5lcG9jaHNFcnJvclJhdGUgPSBuZXcgRmxvYXQzMkFycmF5KGVwb2NoQW1vdW50KTtcbiAgICAvLyB3ZSB3aWxsIHVwZGF0ZSBhbGwgZHcgcmlnaHQgaW4gZXZlcnkgaXRlcmF0aW9uXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcG9jaEFtb3VudDsgaSsrKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMuUkVTRVRfV0VJR0hUU19BRlRFUiAmJlxuICAgICAgICBpICUgdGhpcy5SRVNFVF9XRUlHSFRTX0FGVEVSID09PSAwICYmXG4gICAgICAgIHRoaXMuZXBvY2hzRXJyb3JSYXRlW2kgLSAxXSA+IHRoaXMuTkVFREVEX0VSUk9SX1JBVEVcbiAgICAgICkge1xuICAgICAgICB0aGlzLmluaXRXZWlnaHRzKCk7XG4gICAgICAgIHRoaXMuaW5pdEJpYXNlcygpO1xuICAgICAgfVxuICAgICAgdGhpcy5pdGVyYXRpb25zRXJyb3JSYXRlID0gbmV3IEZsb2F0MzJBcnJheSh0cmFpbmluZ0RhdGEubGVuZ3RoKTtcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy50cmFpbmluZ0RhdGEubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgY29uc3QgaXRlcmF0aW9uRXJyb3IgPSB0aGlzLnRyYWluSXRlcmF0aW9uKHRyYWluaW5nRGF0YVtqXSk7XG4gICAgICAgIHRoaXMuaXRlcmF0aW9uc0Vycm9yUmF0ZVtqXSA9IGl0ZXJhdGlvbkVycm9yO1xuICAgICAgfVxuICAgICAgY29uc3QgbWVhbkVwb2NoRXJyb3JSYXRlID1cbiAgICAgICAgdGhpcy5pdGVyYXRpb25zRXJyb3JSYXRlLnJlZHVjZSgoYWNjLCB2YWx1ZSkgPT4gYWNjICsgdmFsdWUpIC9cbiAgICAgICAgdHJhaW5pbmdEYXRhLmxlbmd0aDtcbiAgICAgIHRoaXMuZXBvY2hzRXJyb3JSYXRlW2ldID0gbWVhbkVwb2NoRXJyb3JSYXRlO1xuICAgICAgdGhpcy5fb25FcG9jaFVwZGF0ZSh0aGlzLnRyYWluaW5nRXBvY2gpO1xuICAgICAgdGhpcy50cmFpbmluZ0Vwb2NoICs9IDE7XG4gICAgfVxuICB9XG5cbiAgZGlzcGxheVJlc3VsdChpbnB1dDogbnVtYmVyW10sIGV4cGVjdGVkOiBudW1iZXJbXSkge1xuICAgIGNvbnN0IGZvcm1hdGVkUmVzdWx0ID0gdGhpcy5ydW4oaW5wdXQpLm1hcCgodikgPT4gK3YudG9GaXhlZCgzKSk7XG4gICAgY29uc29sZS5sb2coYCR7Zm9ybWF0ZWRSZXN1bHR9LCBleHBlY3RlZCAke2V4cGVjdGVkfWApO1xuICB9XG5cbiAgb25FcG9jaFVwZGF0ZShjYWxsYmFjazogQ2FsbGFibGVGdW5jdGlvbikge1xuICAgIHRoaXMuX29uRXBvY2hVcGRhdGUgPSBjYWxsYmFjaztcbiAgfVxufVxuIiwiaW1wb3J0IHsgTmV1cmFsIH0gZnJvbSBcIi4vTmV1cmFsXCI7XG5cbmNvbnN0IGNsZWFyQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NsZWFyJyk7XG5jb25zdCBjYW52YXMgPSA8SFRNTENhbnZhc0VsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RyYXcnKTtcbmNvbnN0IHJlc3VsdFRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdC10YWJsZScpO1xuY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5jb25zdCBwZW5XaWR0aCA9IDE7XG5jb25zdCBjb29yZCA9IHsgeDogMCwgeTogMCB9O1xuXG5jb25zdCBuID0gbmV3IE5ldXJhbChbNzg0LCAxNiwgMTYsIDEwXSk7XG4oYXN5bmMgKCkgPT4ge1xuICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCgnLi8zLmpzb24nKTtcbiAgY29uc3Qgd2VpZ2h0c0RhdGEgPSBhd2FpdCByZXMuanNvbigpO1xuICBuLnNldFdlaWdodHMod2VpZ2h0c0RhdGEpO1xufSkoKTtcblxuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHN0YXJ0KTtcbmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgc3RvcCk7XG5jbGVhckJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsZWFyKTtcblxuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBzdGFydCk7XG5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBzdG9wKTtcblxuaW5pdCgpO1xuXG5mdW5jdGlvbiBpbml0KCkge1xuICBjdHguY2FudmFzLndpZHRoID0gMjg7XG4gIGN0eC5jYW52YXMuaGVpZ2h0ID0gMjg7XG4gIGNsZWFyKCk7XG59XG5cbmZ1bmN0aW9uIGNsZWFyKCkge1xuICBjdHguZmlsbFN0eWxlID0gJyMwMDAnO1xuICBjdHguZmlsbFJlY3QoMCwgMCwgY3R4LmNhbnZhcy53aWR0aCwgY3R4LmNhbnZhcy5oZWlnaHQpO1xuICBjdHguZmlsbFN0eWxlID0gJyNmZmYnO1xuICB1cGRhdGVSZXN1bHQobmV3IEFycmF5KDEwKS5maWxsKDApKTtcbn1cblxuZnVuY3Rpb24gc3RhcnQoZXZlbnQ6IE1vdXNlRXZlbnR8VG91Y2hFdmVudCkge1xuICBpZiAoZXZlbnQgaW5zdGFuY2VvZiBNb3VzZUV2ZW50KSB7XG4gICAgaWYgKChldmVudCBhcyBNb3VzZUV2ZW50KS5idXR0b24gIT09IDApIHJldHVybjtcbiAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZHJhdyk7XG4gIH0gZWxzZSB7XG4gICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIGRyYXcpO1xuICB9XG4gIHJlcG9zaXRpb24oZXZlbnQpO1xuICAvLyBtb3VzZSBldmVudFxuICBcbn1cblxuZnVuY3Rpb24gcmVwb3NpdGlvbihldmVudDogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQpIHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgaWYgKGV2ZW50IGluc3RhbmNlb2YgTW91c2VFdmVudCkge1xuICAgIGNvb3JkLnggPSBldmVudC5vZmZzZXRYIC8gMTAgLSBwZW5XaWR0aCAvIDI7XG4gICAgY29vcmQueSA9IGV2ZW50Lm9mZnNldFkgLyAxMCAtIHBlbldpZHRoIC8gMjtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCB0b3VjaCA9IGV2ZW50LnRvdWNoZXNbMF07XG4gICAgY29uc3Qgb2Zmc2V0RWxlbWVudCA9IGNhbnZhcy5vZmZzZXRQYXJlbnQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgY29vcmQueCA9ICh0b3VjaC5wYWdlWCAtIG9mZnNldEVsZW1lbnQub2Zmc2V0TGVmdCkgLyAxMCAtIHBlbldpZHRoIC8gMjtcbiAgICBjb29yZC55ID0gKHRvdWNoLnBhZ2VZIC0gb2Zmc2V0RWxlbWVudC5vZmZzZXRUb3ApIC8gMTAgLSBwZW5XaWR0aCAvIDI7XG4gIH1cbiAgXG59XG5cbmZ1bmN0aW9uIHN0b3AoKSB7XG4gIGNhbnZhcy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBkcmF3KTtcbn1cblxuZnVuY3Rpb24gZHJhdyhldmVudDogTW91c2VFdmVudCkge1xuICBjdHguYmVnaW5QYXRoKCk7XG4gIGN0eC5saW5lV2lkdGggPSAyO1xuICBjdHgubGluZUNhcCA9ICdyb3VuZCc7XG4gIGN0eC5zdHJva2VTdHlsZSA9ICcjZmZmJztcbiAgY3R4Lm1vdmVUbyhjb29yZC54LCBjb29yZC55KTtcbiAgcmVwb3NpdGlvbihldmVudCk7XG4gIGN0eC5saW5lVG8oY29vcmQueCwgY29vcmQueSk7XG4gIGN0eC5zdHJva2UoKTtcbiAgY29uc3QgY2FudmFzRGF0YSA9IGdldENhbnZhc0RhdGEoKTtcbiAgY29uc3QgcmVzdWx0ID0gbi5ydW4oY2FudmFzRGF0YSk7XG4gIHVwZGF0ZVJlc3VsdChyZXN1bHQpO1xufVxuXG5mdW5jdGlvbiBnZXRDYW52YXNEYXRhKCkge1xuICBjb25zdCBpbWFnZURhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIGN0eC5jYW52YXMud2lkdGgsIGN0eC5jYW52YXMuaGVpZ2h0KTtcbiAgLy8ga2VleSBldmVyeSA0dGggZWxlbWVudHMocikgd2l0aG91dCAoZ2JhKVxuICBjb25zdCBkYXRhID0gQXJyYXkuZnJvbShpbWFnZURhdGEuZGF0YS5maWx0ZXIoKF8sIGkpID0+IGkgJSA0ID09PSAwKSkubWFwKFxuICAgICh2KSA9PiB2IC8gMjU1XG4gICk7XG4gIHJldHVybiBkYXRhO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVSZXN1bHQocmVzdWx0OiBudW1iZXJbXSkge1xuICBjb25zdCByb3dzID0gcmVzdWx0VGFibGUuY2hpbGRyZW5bMF0uY2hpbGRyZW47XG4gIEFycmF5LmZyb20ocm93cykuZm9yRWFjaCgocm93LCBpKSA9PiB7XG4gICAgKHJvdy5jaGlsZHJlblsxXSBhcyBIVE1MRWxlbWVudCkuaW5uZXJUZXh0ID0gKCtyZXN1bHRbaV0udG9GaXhlZCgzKSkudG9TdHJpbmcoKTtcbiAgfSk7XG59XG4iXSwibmFtZXMiOlsibGF5ZXJzTGF5b3V0IiwibmV1cm9ucyIsIndlaWdodHMiLCJiaWFzZXNXZWlnaHRzIiwidHJhaW5pbmdFcG9jaCIsInRyYWluaW5nSXRlcmF0aW9uIiwidHJhaW5pbmdEYXRhIiwibW9tZW50dW0iLCJsZWFybmluZ1JhdGUiLCJORUVERURfRVJST1JfUkFURSIsIlJFU0VUX1dFSUdIVFNfQUZURVIiLCJsYXRlc3REZWx0YVdlaWdodHMiLCJsYXRlc3REZWx0YUJpYXNlc1dlaWdodHMiLCJfb25FcG9jaFVwZGF0ZSIsImxlbmd0aCIsIkVycm9yIiwidGhpcyIsImluaXQiLCJpbml0TmV1cm9ucyIsImkiLCJGbG9hdDMyQXJyYXkiLCJpbml0V2VpZ2h0cyIsImoiLCJtYXAiLCJyYW5kb20iLCJsYXllciIsIm5ldXJvbiIsImluaXRCaWFzZXMiLCJzbGljZSIsIk1hdGgiLCJtaW4iLCJtYXgiLCJhY3RpdmF0aW9uRnVuY3Rpb24iLCJ4IiwiZXhwIiwiZGVyaXZhdGl2ZSIsIm91dHB1dCIsIm11bHRpcGx5TWF0cml4IiwiYSIsImIiLCJmcm9tIiwicmVkdWNlIiwic3VtIiwiY3VyIiwiY291bnRNU0VFcnJvciIsInJlc3VsdCIsIm91dCIsInRyYWluSXRlcmF0aW9uIiwiaW5wdXQiLCJydW4iLCJkZWx0YU5ldXJvbnMiLCJvdXRwdXROZXVyb24iLCJkZWx0YU5ldXJvbiIsIndlaWdodHNTdW0iLCJ2IiwiayIsImdyYWQiLCJkdyIsInNldFdlaWdodHMiLCJiaWFzZXMiLCJpbnB1dERhdGEiLCJuZXVyb25JbnB1dCIsIm5ldXJvblZhbHVlIiwiY2FsbCIsInRyYWluIiwiZXBvY2hBbW91bnQiLCJlcG9jaHNFcnJvclJhdGUiLCJpdGVyYXRpb25zRXJyb3JSYXRlIiwiaXRlcmF0aW9uRXJyb3IiLCJtZWFuRXBvY2hFcnJvclJhdGUiLCJhY2MiLCJ2YWx1ZSIsImRpc3BsYXlSZXN1bHQiLCJleHBlY3RlZCIsImZvcm1hdGVkUmVzdWx0IiwidG9GaXhlZCIsImNvbnNvbGUiLCJsb2ciLCJvbkVwb2NoVXBkYXRlIiwiY2FsbGJhY2siLCJjbGVhckJ0biIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjYW52YXMiLCJyZXN1bHRUYWJsZSIsImN0eCIsImdldENvbnRleHQiLCJwZW5XaWR0aCIsImNvb3JkIiwieSIsIm4iLCJOZXVyYWwiLCJjbGVhciIsImZpbGxTdHlsZSIsImZpbGxSZWN0Iiwid2lkdGgiLCJoZWlnaHQiLCJ1cGRhdGVSZXN1bHQiLCJBcnJheSIsImZpbGwiLCJzdGFydCIsImV2ZW50IiwiTW91c2VFdmVudCIsImJ1dHRvbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJkcmF3IiwicmVwb3NpdGlvbiIsInByZXZlbnREZWZhdWx0Iiwib2Zmc2V0WCIsIm9mZnNldFkiLCJ0b3VjaCIsInRvdWNoZXMiLCJvZmZzZXRFbGVtZW50Iiwib2Zmc2V0UGFyZW50IiwicGFnZVgiLCJvZmZzZXRMZWZ0IiwicGFnZVkiLCJvZmZzZXRUb3AiLCJzdG9wIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImJlZ2luUGF0aCIsImxpbmVXaWR0aCIsImxpbmVDYXAiLCJzdHJva2VTdHlsZSIsIm1vdmVUbyIsImxpbmVUbyIsInN0cm9rZSIsImltYWdlRGF0YSIsImNhbnZhc0RhdGEiLCJnZXRJbWFnZURhdGEiLCJkYXRhIiwiZmlsdGVyIiwiXyIsInJvd3MiLCJjaGlsZHJlbiIsImZvckVhY2giLCJyb3ciLCJpbm5lclRleHQiLCJ0b1N0cmluZyIsImZldGNoIiwianNvbiIsIndlaWdodHNEYXRhIl0sInNvdXJjZVJvb3QiOiIifQ==